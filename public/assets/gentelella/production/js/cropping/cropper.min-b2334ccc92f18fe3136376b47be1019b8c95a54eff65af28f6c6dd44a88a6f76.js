!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(c){"use strict";function d(t){return"number"==typeof t}function p(t){return"string"==typeof t}function e(t){return void 0===t}function o(t,i){var e=[];return d(i)&&e.push(i),e.slice.apply(t,e)}function i(t,i){var e=o(arguments,2);return function(){return t.apply(i,e.concat(o(arguments)))}}function r(t){var i=t.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return!(!i||i[1]===u.protocol&&i[2]===u.hostname&&i[3]===u.port)}function n(t){var i="timestamp="+(new Date).getTime();return t+(-1===t.indexOf("?")?"?":"&")+i}function l(t){return t?"rotate("+t+"deg)":"none"}function g(t){var i=U(t.degree)%180,e=(90<i?180-i:i)*Math.PI/180;return{width:t.width*_(e)+t.height*Z(e),height:t.width*Z(e)+t.height*_(e)}}function w(t,i){var e=c("<canvas>")[0],h=e.getContext("2d"),s=i.naturalWidth,a=i.naturalHeight,o=i.rotate,r=g({width:s,height:a,degree:o});return o?(e.width=r.width,e.height=r.height,h.save(),h.translate(r.width/2,r.height/2),h.rotate(o*Math.PI/180),h.drawImage(t,-s/2,-a/2,s,a),h.restore()):(e.width=s,e.height=a,h.drawImage(t,0,0,s,a)),e}function f(t,i){this.$element=c(t),this.options=c.extend({},f.DEFAULTS,c.isPlainObject(i)&&i),this.ready=!1,this.built=!1,this.cropped=!1,this.disabled=!1,this.load()}var t,h,s=c(window),a=c(document),u=window.location,m="directive",v=".cropper",x=/^(e|n|w|s|ne|nw|sw|se|all|crop|move|zoom)$/,b="cropper-modal",y="cropper-hide",C="cropper-hidden",$="cropper-invisible",D="cropper-move",B="cropper-crop",k="cropper-disabled",W="cropper-bg",I="mousedown touchstart",Y="mousemove touchmove",H="mouseup mouseleave touchend touchleave touchcancel",X="wheel mousewheel DOMMouseScroll",z="dblclick",L="resize"+v,T="build"+v,M="built"+v,R="dragstart"+v,E="dragmove"+v,P="dragend"+v,j={canvas:c.isFunction(c("<canvas>")[0].getContext)},O=Math.round,A=Math.sqrt,F=Math.min,N=Math.max,U=Math.abs,Z=Math.sin,_=Math.cos,S=parseFloat,q={};q.load=function(){var t,e,h,s=this,i=this.options,a=this.$element,o="";a.is("img")?h=a.prop("src"):a.is("canvas")&&j.canvas&&(h=a[0].toDataURL()),h&&(t=c.Event(T),a.one(T,i.build).trigger(t),t.isDefaultPrevented()||(i.checkImageOrigin&&r(h)&&(o=" crossOrigin",h=n(h)),this.$clone=e=c("<img"+o+' src="'+h+'">'),e.one("load",function(){var t=this.naturalWidth||e.width(),i=this.naturalHeight||e.height();s.image={naturalWidth:t,naturalHeight:i,aspectRatio:t/i,rotate:0},s.url=h,s.ready=!0,s.build()}),e.addClass(y).prependTo("body")))},q.build=function(){var t,i,e=this.$element,h=this.options;this.ready&&(this.built&&this.unbuild(),this.$cropper=t=c(f.TEMPLATE),e.addClass(C),this.$clone.removeClass(y).prependTo(t),this.$container=e.parent(),this.$container.append(t),this.$canvas=t.find(".cropper-canvas"),this.$cropBox=i=t.find(".cropper-cropbox"),this.$viewer=t.find(".cropper-viewer"),this.addListeners(),this.initPreview(),h.aspectRatio=U(S(h.aspectRatio))||NaN,h.autoCrop?(this.cropped=!0,h.modal&&this.$canvas.addClass(b)):i.addClass(C),h.background&&t.addClass(W),!h.highlight&&i.find(".cropper-face").addClass($),!h.guides&&i.find(".cropper-dashed").addClass(C),!h.movable&&i.find(".cropper-face").data(m,"move"),!h.resizable&&i.find(".cropper-line, .cropper-point").addClass(C),this.setDragMode(h.dragCrop?"crop":"move"),this.built=!0,this.render(),e.one(M,h.built).trigger(M))},q.unbuild=function(){this.built&&(this.built=!1,this.removeListeners(),this.$preview.empty(),this.$preview=null,this.$cropBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)},c.extend(q,{render:function(){this.initContainer(),this.initImage(),this.initCropBox()},initContainer:function(){var t=this.$element,i=this.$container,e=this.$cropper,h=this.options;e.addClass(C),t.removeClass(C),e.css(this.container={width:N(i.width(),S(h.minContainerWidth)||350),height:N(i.height(),S(h.minContainerHeight)||150)}),t.addClass(C),e.removeClass(C)},initImage:function(){var t=this.container,i=this.image,e=i.aspectRatio,h=t.width,s=t.height,a=i.naturalWidth,o=i.naturalHeight,r=0,n=0;h<s*e?n=(s-(o=(a=h)/e))/2:r=(h-(a=(o=s)*e))/2,c.extend(i,{width:a,height:o,left:r,top:n}),this.defaultImage=c.extend({},i),this.renderImage()},renderImage:function(t){var i,e=this.options,h=this.image,s=h.width,a=h.height,o=h.rotate;o&&(i=g({width:s,height:a,degree:o})),c.extend(h,{rotatedWidth:i?i.width:h.width,rotatedHeight:i?i.height:h.height,rotatedLeft:i?h.left-(i.width-s)/2:h.left,rotatedTop:i?h.top-(i.height-a)/2:h.top}),this.$clone.css({width:s,height:a,marginLeft:h.left,marginTop:h.top,transform:l(o)}),t&&(this.preview(),c.isFunction(e.crop)&&e.crop.call(this.$element,this.getData()))},initCropBox:function(){var t=this.options,i=this.container,e=this.image,h=t.aspectRatio,s=i.width,a=i.height,o=U(S(t.minCropBoxWidth))||0,r=U(S(t.minCropBoxHeight))||0,n=U(S(t.autoCropArea))||.8,d={width:e.width,height:e.height,minWidth:o,minHeight:r,maxWidth:s,maxHeight:a};h&&(s<a*h?(d.height=d.width/h,d.maxHeight=s/h):(d.width=e.height*h,d.maxWidth=a*h),o?d.minHeight=d.minWidth/h:r&&(d.minWidth=d.minHeight*h)),d.minWidth=F(d.maxWidth,d.minWidth),d.minHeight=F(d.maxHeight,d.minHeight),d.width=N(d.minWidth,d.width*n),d.height=N(d.minHeight,d.height*n),d.left=(s-d.width)/2,d.top=(a-d.height)/2,d.oldLeft=d.left,d.oldTop=d.top,this.defaultCropBox=c.extend({},d),this.cropBox=d,this.cropped&&this.renderCropBox()},renderCropBox:function(){var t=this.options,i=this.container,e=this.$cropBox,h=this.cropBox;h.width>h.maxWidth?(h.width=h.maxWidth,h.left=h.oldLeft):h.width<h.minWidth&&(h.width=h.minWidth,h.left=h.oldLeft),h.height>h.maxHeight?(h.height=h.maxHeight,h.top=h.oldTop):h.height<h.minHeight&&(h.height=h.minHeight,h.top=h.oldTop),h.left=F(N(h.left,0),i.width-h.width),h.top=F(N(h.top,0),i.height-h.height),h.oldLeft=h.left,h.oldTop=h.top,t.movable&&e.find(".cropper-face").data(m,h.width===i.width&&h.height===i.height?"move":"all"),e.css({width:h.width,height:h.height,left:h.left,top:h.top}),this.disabled||(this.preview(),c.isFunction(t.crop)&&t.crop.call(this.$element,this.getData()))}}),q.initPreview=function(){var i=this.url;this.$preview=c(this.options.preview),this.$viewer.html('<img src="'+i+'">'),this.$preview.each(function(){var t=c(this);t.data({width:t.width(),height:t.height()}).html('<img src="'+i+'" style="display:block;width:100%;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;">')})},q.preview=function(){var t=this.image,a=this.cropBox,o=t.width,r=t.height,n=a.left-t.left,d=a.top-t.top,p=t.rotate;this.cropped&&!this.disabled&&(this.$viewer.find("img").css({width:o,height:r,marginLeft:-n,marginTop:-d,transform:l(p)}),this.$preview.each(function(){var t=c(this),i=t.data(),e=i.width/a.width,h=i.width,s=a.height*e;s>i.height&&(e=i.height/a.height,h=a.width*e,s=i.height),t.width(h).height(s).find("img").css({width:o*e,height:r*e,marginLeft:-n*e,marginTop:-d*e,transform:l(p)})}))},q.addListeners=function(){var t=this.options;this.$element.on(R,t.dragstart).on(E,t.dragmove).on(P,t.dragend),this.$cropper.on(I,c.proxy(this.dragstart,this)).on(z,c.proxy(this.dblclick,this)),t.zoomable&&t.mouseWheelZoom&&this.$cropper.on(X,c.proxy(this.wheel,this)),t.global?a.on(Y,this._dragmove=i(this.dragmove,this)).on(H,this._dragend=i(this.dragend,this)):this.$cropper.on(Y,c.proxy(this.dragmove,this)).on(H,c.proxy(this.dragend,this)),t.responsive&&s.on(L,this._resize=i(this.resize,this))},q.removeListeners=function(){var t=this.options;this.$element.off(R,t.dragstart).off(E,t.dragmove).off(P,t.dragend),this.$cropper.off(I,this.dragstart).off(z,this.dblclick),t.zoomable&&t.mouseWheelZoom&&this.$cropper.off(X,this.wheel),t.global?a.off(Y,this._dragmove).off(H,this._dragend):this.$cropper.off(Y,this.dragmove).off(H,this.dragend),t.responsive&&s.off(L,this._resize)},c.extend(q,{resize:function(){var t=this.$container,i=this.container;this.disabled||(t.width()!==i.width||t.height()!==i.height)&&(clearTimeout(this.resizing),this.resizing=setTimeout(c.proxy(function(){var t=this.getImageData(),i=this.getCropBoxData();this.render(),this.setImageData(t),this.setCropBoxData(i)},this),200))},dblclick:function(){this.disabled||this.setDragMode(this.$canvas.hasClass(B)?"move":"crop")},wheel:function(t){var i=t.originalEvent,e=1;this.disabled||(t.preventDefault(),i.deltaY?e=0<i.deltaY?1:-1:i.wheelDelta?e=-i.wheelDelta/120:i.detail&&(e=0<i.detail?1:-1),this.zoom(.1*e))},dragstart:function(t){var i,e,h,s=this.options,a=t.originalEvent,o=a&&a.touches,r=t;if(!this.disabled){if(o){if(1<(h=o.length)){if(!s.zoomable||!s.touchDragZoom||2!==h)return;r=o[1],this.startX2=r.pageX,this.startY2=r.pageY,i="zoom"}r=o[0]}if(i=i||c(r.target).data(m),x.test(i)){if(t.preventDefault(),e=c.Event(R),this.$element.trigger(e),e.isDefaultPrevented())return;this.directive=i,this.cropping=!1,this.startX=r.pageX,this.startY=r.pageY,"crop"===i&&(this.cropping=!0,this.$canvas.addClass(b))}}},dragmove:function(t){var i,e,h=this.options,s=t.originalEvent,a=s&&s.touches,o=t;if(!this.disabled){if(a){if(1<(e=a.length)){if(!h.zoomable||!h.touchDragZoom||2!==e)return;o=a[1],this.endX2=o.pageX,this.endY2=o.pageY}o=a[0]}if(this.directive){if(t.preventDefault(),i=c.Event(E),this.$element.trigger(i),i.isDefaultPrevented())return;this.endX=o.pageX,this.endY=o.pageY,this.change()}}},dragend:function(t){var i;if(!this.disabled&&this.directive){if(t.preventDefault(),i=c.Event(P),this.$element.trigger(i),i.isDefaultPrevented())return;this.cropping&&(this.cropping=!1,this.$canvas.toggleClass(b,this.cropped&&this.options.modal)),this.directive=""}}}),c.extend(q,{reset:function(){this.cropped&&!this.disabled&&(this.image=c.extend({},this.defaultImage),this.renderImage(),this.cropBox=c.extend({},this.defaultCropBox),this.renderCropBox())},clear:function(){var t=this.cropBox;this.cropped&&!this.disabled&&(this.cropped=!1,t.left=0,t.top=0,t.width=0,t.height=0,this.renderCropBox(),this.$canvas.removeClass(b),this.$cropBox.addClass(C))},destroy:function(){var t=this.$element;this.ready||this.$clone.off("load").remove(),this.unbuild(),t.removeClass(C).removeData("cropper")},replace:function(t){var i,e,h=this,s=this.$element;!this.disabled&&t&&t!==this.url&&t!==s.attr("src")&&(s.is("img")?(s.attr("src",t),this.load()):s.is("canvas")&&j.canvas&&(i=s[0],e=i.getContext("2d"),c('<img src="'+t+'"">').one("load",function(){i.width=this.width,i.height=this.height,e.clearRect(0,0,i.width,i.height),e.drawImage(this,0,0),h.load()})))},enable:function(){this.built&&(this.disabled=!1,this.$cropper.removeClass(k))},disable:function(){this.built&&(this.disabled=!0,this.$cropper.addClass(k))},move:function(t,i){var e=this.image;!this.disabled&&d(t)&&d(i)&&(e.left+=t,e.top+=i,this.renderImage(!0))},zoom:function(t){var i,e,h=this.image;(t=S(t))&&this.built&&!this.disabled&&this.options.zoomable&&(t=t<=-1?1/(1-t):t<=1?1+t:t,i=h.width*t,e=h.height*t,h.left-=(i-h.width)/2,h.top-=(e-h.height)/2,h.width=i,h.height=e,this.renderImage(!0),this.setDragMode("move"))},rotate:function(t){var i=this.image;0!==(t=S(t)||0)&&this.built&&!this.disabled&&this.options.rotatable&&(i.rotate=(i.rotate+t)%360,this.renderImage(!0))},getData:function(e){var h,s,t=this.cropBox,i=this.image,a=i.rotate;return this.built&&this.cropped?(s={x:t.left-(a?i.rotatedLeft:i.left),y:t.top-(a?i.rotatedTop:i.top),width:t.width,height:t.height},h=i.width/i.naturalWidth,c.each(s,function(t,i){i/=h,s[t]=e?O(i):i}),s.rotate=a):s={x:0,y:0,width:0,height:0,rotate:a},s},getImageData:function(t){var i=this.image,e={};return this.built&&c.extend(e,t?i:{left:i.left,top:i.top,width:i.width,height:i.height}),e},setImageData:function(t){var i=this.image;this.built&&!this.disabled&&c.isPlainObject(t)&&(d(t.left)&&(i.left=t.left),d(t.top)&&(i.top=t.top),d(t.width)?(i.width=t.width,i.height=i.width/i.aspectRatio):d(t.height)&&(i.height=t.height,i.width=i.height*i.aspectRatio),this.renderImage(!0))},getCropBoxData:function(){var t,i={};return this.cropped&&(i={left:(t=this.cropBox).left,top:t.top,width:t.width,height:t.height}),i},setCropBoxData:function(t){var i=this.cropBox,e=this.options.aspectRatio;this.cropped&&!this.disabled&&c.isPlainObject(t)&&(d(t.left)&&(i.left=t.left),d(t.top)&&(i.top=t.top),e?d(t.width)?(i.width=t.width,i.height=i.width/e):d(t.height)&&(i.height=t.height,i.width=i.height*e):(d(t.width)&&(i.width=t.width),d(t.height)&&(i.height=t.height)),this.renderCropBox())},getDataURL:function(t,i,e){var g,f,h,s,u,a,m,o,r,v,n;return this.cropped&&j.canvas&&(v=this.getData(),g=v.width,f=v.height,(m=c.isPlainObject(t))?(u=t.width||g,a=t.height||f):(e=i,i=t),h=m?u:g,s=m?a:f,(o=c("<canvas>")[0]).width=h,o.height=s,r=o.getContext("2d"),"image/jpeg"===i&&(r.fillStyle="#fff",r.fillRect(0,0,h,s)),r.drawImage.apply(r,function(){var t,i,e,h,s,a,o,r=w(this.$clone[0],this.image),n=r.width,d=r.height,p=[r],c=v.x,l=v.y;return c<=-g||n<c?c=t=e=s=0:c<=0?(e=-c,t=s=F(n,g+(c=0))):c<=n&&(e=0,t=s=F(g,n-c)),t<=0||l<=-f||d<l?l=i=h=a=0:l<=0?(h=-l,i=a=F(d,f+(l=0))):l<=d&&(h=0,i=a=F(f,d-l)),p.push(c,l,t,i),m&&(e/=o=g/u,h/=o,s/=o,a/=o),0<s&&0<a&&p.push(e,h,s,a),p}.call(this)),n=o.toDataURL.apply(o,function(){var t=[];return p(i)&&t.push(i),d(e)&&t.push(e),t}.call(this))),n||""},setAspectRatio:function(t){var i=this.options;this.disabled||e(t)||(i.aspectRatio=U(S(t))||NaN,this.built&&this.initCropBox())},setDragMode:function(t){var i=this.$canvas,e=!1,h=!1;if(this.ready&&!this.disabled){switch(t){case"crop":this.options.dragCrop?(e=!0,i.data(m,t)):h=!0;break;case"move":h=!0,i.data(m,t);break;default:i.removeData(m)}i.toggleClass(B,e).toggleClass(D,h)}}}),q.change=function(){var t,i,e,h,s,a,o,r=this.directive,n=this.image,d=this.container,p=d.width,c=d.height,l=this.cropBox,g=l.width,f=l.height,u=l.left,m=l.top,v=u+g,w=m+f,x=!0,b=this.options.aspectRatio,y={x:this.endX-this.startX,y:this.endY-this.startY};switch(b&&(y.X=y.y*b,y.Y=y.x/b),r){case"all":u+=y.x,m+=y.y;break;case"e":if(0<=y.x&&(p<=v||b&&(m<=0||c<=w))){x=!1;break}g+=y.x,b&&(f=g/b,m-=y.Y/2),g<0&&(r="w",g=0);break;case"n":if(y.y<=0&&(m<=0||b&&(u<=0||p<=v))){x=!1;break}f-=y.y,m+=y.y,b&&(g=f*b,u+=y.X/2),f<0&&(r="s",f=0);break;case"w":if(y.x<=0&&(u<=0||b&&(m<=0||c<=w))){x=!1;break}g-=y.x,u+=y.x,b&&(f=g/b,m+=y.Y/2),g<0&&(r="e",g=0);break;case"s":if(0<=y.y&&(c<=w||b&&(u<=0||p<=v))){x=!1;break}f+=y.y,b&&(g=f*b,u-=y.X/2),f<0&&(r="n",f=0);break;case"ne":if(b){if(y.y<=0&&(m<=0||p<=v)){x=!1;break}f-=y.y,m+=y.y,g=f*b}else 0<=y.x?v<p?g+=y.x:y.y<=0&&m<=0&&(x=!1):g+=y.x,y.y<=0?0<m&&(f-=y.y,m+=y.y):(f-=y.y,m+=y.y);g<0&&f<0?(r="sw",g=f=0):g<0?(r="nw",g=0):f<0&&(r="se",f=0);break;case"nw":if(b){if(y.y<=0&&(m<=0||u<=0)){x=!1;break}f-=y.y,m+=y.y,g=f*b,u+=y.X}else y.x<=0?0<u?(g-=y.x,u+=y.x):y.y<=0&&m<=0&&(x=!1):(g-=y.x,u+=y.x),y.y<=0?0<m&&(f-=y.y,m+=y.y):(f-=y.y,m+=y.y);g<0&&f<0?(r="se",g=f=0):g<0?(r="ne",g=0):f<0&&(r="sw",f=0);break;case"sw":if(b){if(y.x<=0&&(u<=0||c<=w)){x=!1;break}g-=y.x,u+=y.x,f=g/b}else y.x<=0?0<u?(g-=y.x,u+=y.x):0<=y.y&&c<=w&&(x=!1):(g-=y.x,u+=y.x),0<=y.y?w<c&&(f+=y.y):f+=y.y;g<0&&f<0?(r="ne",g=f=0):g<0?(r="se",g=0):f<0&&(r="nw",f=0);break;case"se":if(b){if(0<=y.x&&(p<=v||c<=w)){x=!1;break}f=(g+=y.x)/b}else 0<=y.x?v<p?g+=y.x:0<=y.y&&c<=w&&(x=!1):g+=y.x,0<=y.y?w<c&&(f+=y.y):f+=y.y;g<0&&f<0?(r="nw",g=f=0):g<0?(r="sw",g=0):f<0&&(r="ne",f=0);break;case"move":n.left+=y.x,n.top+=y.y,this.renderImage(!0),x=!1;break;case"zoom":this.zoom((i=n.width,e=n.height,h=U(this.startX-this.startX2),s=U(this.startY-this.startY2),a=U(this.endX-this.endX2),o=U(this.endY-this.endY2),(A(a*a+o*o)-A(h*h+s*s))/A(i*i+e*e))),this.endX2=this.startX2,this.endY2=this.startY2,x=!1;break;case"crop":y.x&&y.y&&(t=this.$cropper.offset(),u=this.startX-t.left,m=this.startY-t.top,g=l.minWidth,f=l.minHeight,0<y.x?0<y.y?r="se":(r="ne",m-=f):0<y.y?(r="sw",u-=g):(r="nw",u-=g,m-=f),this.cropped||(this.cropped=!0,this.$cropBox.removeClass(C)))}x&&(l.width=g,l.height=f,l.left=u,l.top=m,this.directive=r,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY},c.extend(f.prototype,q),f.DEFAULTS={aspectRatio:NaN,autoCropArea:.8,crop:null,preview:"",global:!0,responsive:!0,checkImageOrigin:!0,modal:!0,guides:!0,highlight:!0,background:!0,autoCrop:!0,dragCrop:!0,movable:!0,resizable:!0,rotatable:!0,zoomable:!0,touchDragZoom:!0,mouseWheelZoom:!0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:300,minContainerHeight:150,build:null,built:null,dragstart:null,dragmove:null,dragend:null},f.setDefaults=function(t){c.extend(f.DEFAULTS,t)},f.TEMPLATE=(t='<0 6="5-container"><0 6="5-canvas"></0><0 6="5-cropbox"><1 6="5-viewer"></1><1 6="5-8 8-h"></1><1 6="5-8 8-v"></1><1 6="5-face" 3-2="all"></1><1 6="5-7 7-e" 3-2="e"></1><1 6="5-7 7-n" 3-2="n"></1><1 6="5-7 7-w" 3-2="w"></1><1 6="5-7 7-s" 3-2="s"></1><1 6="5-4 4-e" 3-2="e"></1><1 6="5-4 4-n" 3-2="n"></1><1 6="5-4 4-w" 3-2="w"></1><1 6="5-4 4-s" 3-2="s"></1><1 6="5-4 4-ne" 3-2="ne"></1><1 6="5-4 4-nw" 3-2="nw"></1><1 6="5-4 4-sw" 3-2="sw"></1><1 6="5-4 4-se" 3-2="se"></1></0></0>',h=(h="div,span,directive,data,point,cropper,class,line,dashed").split(","),t.replace(/\d+/g,function(t){return h[t]})),f.other=c.fn.cropper,c.fn.cropper=function(h){var s,a=o(arguments,1);return this.each(function(){var t,i=c(this),e=i.data("cropper");e||i.data("cropper",e=new f(this,h)),"string"==typeof h&&c.isFunction(t=e[h])&&(s=t.apply(e,a))}),e(s)?this:s},c.fn.cropper.Constructor=f,c.fn.cropper.setDefaults=f.setDefaults,c.fn.cropper.noConflict=function(){return c.fn.cropper=f.other,this}});